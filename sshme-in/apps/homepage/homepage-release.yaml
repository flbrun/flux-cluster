apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: homepage
spec:
  interval: 5m
  chart:
    spec:
      chart: homepage
      sourceRef:
        kind: HelmRepository
        name: truecharts
        namespace: flux-system
  values:
    workload:
      main:
        podSpec:
          containers:
            main:
              env:
                HOMEPAGE_ALLOWED_HOSTS: "home.sshme.in"
                LOG_TARGETS: "stdout"

    # âœ… Writable config dir so the init container can do its thing
    persistence:
      config:
        enabled: true
        type: emptyDir
        mountPath: /app/config

    # Your config stays as a ConfigMap generated by the chart
    configmap:
      config:
        enabled: true
        data:
          custom.js: ""
          custom.css: ""
          kubernetes.yaml: |
            mode: cluster
            gateway: true
          settings.yaml: |
            ---
            title: SSHM3-1N
            background:
              image: https://images.unsplash.com/photo-1508144753681-9986d4df99b3?q=80&w=3540&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
              saturate: 50
              brightness: 50
            logpath: /tmp
            providers:
              openweathermap: openweathermapapikey
              weatherapi: weatherapiapikey
          widgets.yaml: |
            ---
            - search:
                provider: custom
                url: https://www.ecosia.org/search?q=
                target: _blank
                suggestionUrl: https://ac.ecosia.org/autocomplete?type=list&q=
                show
